{% extends 'PartialTemplates/Base.html' %}
{% block pagetitle %}{{ pagetitle }}{% endblock %}
{% block customstyles %}<style type="text/css"></style>{% endblock %}
{% block maincontent %}
  <div class="container-fluid">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item active" aria-current="page">
          <i class="fa fa-home"></i> User Profile <i class="fa fa-chevron-right"></i> {{ pagetitle }}
        </li>
      </ol>
    </nav>
    <form name="UserSearchForm" action="" method="get">
      {% csrf_token %}
      <div class="card card-primary card-outline mt-3">
        <div class="card-header">
          <h4 class="card-title header0">User Profile Search</h4>
        </div>
        <div class="card-body card-body-withmaxheight">
          <div class="row mt1">
            <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
              <label for="txtbxsearchbyloginid" class="lbl">
                Login ID <i class="mandatory">*</i>
              </label>
            </div>
            <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
              <input type="text"
                     id="txtbxsearchbyloginid"
                     name="username"
                     class="form-control"
                     placeholder="Login ID"
                     value="{{ searched_username|default:'' }}" />
            </div>
          </div>
          <div class="row mt1">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              <button type="submit"
                      name="actionname"
                      value="searchloginid"
                      class="btn btn-primary btn-sm">Search</button>
              <button type="reset"
                      name="actionname"
                      value="resetpage"
                      class="btn btn-warning btn-sm">Reset</button>
            </div>
          </div>
        </div>
      </div>
    </form>
    {% if user_form and profile_form %}
      <form name="user_update_form" action="" method="post">
        {% csrf_token %}
        <div class="card card-primary card-outline mt-3">
          <div class="card-header">
            <h4 class="card-title header0">User Profile Update</h4>
          </div>
          <div class="card-body card-body-withmaxheight">
            <div class="row mt1">
              <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
                <label for="{{ user_form.first_name.id_for_label }}" class="lbl">
                  First Name <i class="mandatory">*</i>
                </label>
              </div>
              <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">{{ user_form.first_name }} {{ user_form.username }}</div>
              <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
                <label for="{{ user_form.last_name.id_for_label }}" class="lbl">
                  Last Name <i class="mandatory">*</i>
                </label>
              </div>
              <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">{{ user_form.last_name }}</div>
              <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
                <label for="{{ profile_form.site.id_for_label }}" class="lbl">
                  Site <i class="mandatory">*</i>
                </label>
              </div>
              <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">{{ profile_form.site }}</div>
              <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
                <label for="{{ profile_form.language.id_for_label }}" class="lbl">
                  Language <i class="mandatory">*</i>
                </label>
              </div>
              <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">{{ profile_form.language }}</div>
            </div>
            <div class="row mt1">
              <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
                <label for="{{ profile_form.role.id_for_label }}" class="lbl">
                  Role <i class="mandatory">*</i>
                </label>
              </div>
              <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">{{ profile_form.role }}</div>
              <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
                <label for="{{ user_form.email.id_for_label }}" class="lbl">
                  Email ID <i class="mandatory">*</i>
                </label>
              </div>
              <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">{{ user_form.email }}</div>
            </div>
            <div class="row mt1">
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
                <button type="submit"
                        name="actionname"
                        value="save"
                        class="btn btn-primary btn-sm">Save</button>
                <button type="submit"
                        name="actionname"
                        value="resetpassword"
                        class="btn btn-info btn-sm">reset password</button>
                <button type="submit"
                        name="actionname"
                        value="deleteaccount"
                        class="btn btn-danger btn-sm btndeleteaccount">delete profile</button>
                <button type="submit"
                        name="actionname"
                        value="cancelform"
                        class="btn btn-warning btn-sm">cancel</button>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                {% if user_form.errors %}
                  {% for field in user_form %}
                    {% for error in field.errors %}
                      <h6 class="text-danger">
                        <strong>{{ field.label }}:</strong> {{ error }}
                      </h6>
                    {% endfor %}
                  {% endfor %}
                  {% for error in user_form.non_field_errors %}<p class="text-danger">{{ error }}</p>{% endfor %}
                {% endif %}
                {% if profile_form.errors %}
                  {% for field in profile_form %}
                    {% for error in field.errors %}
                      <h6 class="text-danger">
                        <strong>{{ field.label }}:</strong> {{ error }}
                      </h6>
                    {% endfor %}
                  {% endfor %}
                  {% for error in profile_form.non_field_errors %}<p class="text-danger">{{ error }}</p>{% endfor %}
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </form>
    {% endif %}
    {% if ProfileList %}
      <div class="card card-success card-outline mt-3">
        <div class="card-header">
          <h4 class="card-title header0">Recently Created Profiles</h4>
        </div>
        <div class="card-body card-body-withmaxheight">
          <div class="row mt1">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
              <form name="TypeLookupFormDelete" action="" method="post">
                {% csrf_token %}
                <table class="table">
                  <thead>
                    <tr>
                      <th>S No</th>
                      <th>Site</th>
                      <th>Role</th>
                      <th>First Name</th>
                      <th>Last Name</th>
                      <th>Language</th>
                      <th>Login ID</th>
                      <th>Password</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% with loopcount=1 %}
                      {% for item in page_obj %}
                        <tr>
                          <td>{{ forloop.counter }}</td>
                          <td>{{ item.site }}</td>
                          <td>{{ item.role }}</td>
                          <td>{{ item.user.first_name }}</td>
                          <td>{{ item.user.last_name }}</td>
                          <td>{{ item.language }}</td>
                          <td>{{ item.user.username }}</td>
                          <td>
                            {% if item.role == "Candidate" %}
                              {{ item.candpassword|default:"NA" }}
                            {% else %}
                              --
                            {% endif %}
                          </td>
                        </tr>
                      {% endfor %}
                    {% endwith %}
                  </tbody>
                </table>
                <div class="pagination text-right justify-content-end">
                  <ul class="pagination mb-0">
                    {% for num in page_obj.paginator.page_range %}
                      {% if num == page_obj.number %}
                        <li class="active page-item disabled">
                          <a class="page-link" href="#">{{ num }}</a>
                        </li>
                      {% else %}
                        <li class="page-item">
                          <a href="?page={{ num }}" class="page-link">{{ num }}</a>
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>
                <input type="hidden" name="deletelookupid" id="hdftypelookuprecordid" />
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}
{% block customscript %}
  <script type="text/javascript">
    $(document).ready(function () {
      $('.spanloading').show()
    })

$(function() {
  var $input = $("#txtbxsearchbyloginid");

  $input.autocomplete({
    source: function(request, response) {
      $.ajax({
        url: "/onlineassessment/onlineassessmentapi/UserprofileLoginidList",
        dataType: "json",
        data: { loginidmatch: request.term },
        success: function(data) {
          const usernames = $.map(data.result, item => item.username || item);
          response(usernames);
        },
        error: function() { response([]); }
      });
    },
    minLength: 1
  });

  // Optional: trigger search manually on keypress
  $input.on('keyup', function() {
    var term = $(this).val();
    if (term.length >= 2) {
      $input.autocomplete("search", term);
    }
  });
});

$("body").on("click", ".btndeleteaccount", function () {
  //alert('test');
        var delconfirm = confirmdelete();
        if (delconfirm == true) {
           
        }
        else {
            return false;
        }
    });

    function ValidateSubmitForm(){

    }
  </script>
{% endblock customscript %}
